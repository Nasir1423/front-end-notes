<!DOCTYPE html>
<html lang='en'>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>生命周期</title>
  <script src="../js/vue.js"></script>
  <!-- 
    小结
    1. 生命周期概述
      - 生命周期又称生命周期回调函数、生命周期函数、生命周期钩子
      - 生命周期是 Vue 在关键时刻帮我们调用的一些特称名称的函数：beforeCreate、created、beforeMount、mounted、beforeUpdate、
      updated、beforeDestroy、destroyed
      - 生命周期函数中的 this 指向的是 vm 或组件实例对象
    2. 关于模板的进一步说明
      - 通过 HTML 代码指定：下述示例中 id="root" 的 div 及其内部元素属于 Vue 模板
        <div id="root">
          <h1 :style="{opacity}">Welcome to {{name}}</h1>
        </div>
        <script>
          new Vue({
            el: "#root",
            ......
          })
        </script>
      - 通过 template 配置：下述示例中 template 中的所有内容属于 Vue 模板，id="root" 的 div 及其内部元素则被忽略；此外 template 指定的 HTML 结构顶层只能是一个节点
        <div id="root"></div>
        <script>
          new Vue({
            el: "#root",
            template: `
              <div>
                <h1 :style="{opacity}">Welcome to {{name}}</h1>
              </div>
            `
          })
        </script>
    3. 常用的生命周期钩子
			- mounted()：此时发送 ajax 请求、启动定时器、绑定自定义事件、订阅消息等【初始化操作】。
			- beforeDestroy()：清除定时器、解绑自定义事件、取消订阅消息等【收尾工作】。
    4. 关于销毁 Vue 实例
			- 销毁后借助 Vue 开发者工具看不到任何信息。
			- 销毁后自定义事件会失效，但原生 DOM 事件依然有效。
			- 一般不会在 beforeDestroy 操作数据，因为即便操作数据，也不会再触发更新流程了。
   -->
</head>

<body>
  <div id="root">
    <h1 :style="{opacity}">Welcome to {{name}}</h1>
    <button @click="$destroy()">点击终结渲染</button>
  </div>

  <script>
    const vm = new Vue({
      el: '#root',
      data: {
        name: "Vue",
        opacity: 1,
        timer: ""
      },
      /* 生命周期函数及其调用时机 */
      /* 初始化：生命周期、事件 (数据代理未开始) */
      beforeCreate() {
        /* 此时无法通过 vm 访问到 data 中的数据、methods 中的方法 */
        console.log('beforeCreate');
      },
      /* 初始化：数据监测、数据代理 */
      created() {
        /* 此时可以通过 vm 访问到 data 中的数据、methods 中的方法 */
        console.log('created');
      },
      /* Vue 开始解析模板，在内存中生成虚拟 DOM，但页面中还不能显示解析好的内容 */
      beforeMount() {
        /* 页面中呈现的是未经 Vue 编译的 DOM 结构；所有对 DOM 的操作最终都不奏效 */
        console.log('beforeMount');
      },
      /* 将内存中的虚拟 DOM 转换为真实 DOM 插入页面 */
      mounted() {
        /* 页面中呈现的都是经过 Vue 编译的 DOM；所有对 DOM 的操作均有效（尽可能避免） */
        /* 一般这里初始化过程结束，进行：开启定时器、发送网络请求、订阅消息、绑定自定义事件等初始化操作 */
        console.log('mounted');
        this.timer = setInterval(() => {
          this.opacity -= 0.01;
          if (this.opacity <= 0) this.opacity = 1;
        }, 16);
      },
      /* [当数据改变时]，Vue 会在不同的时机调用以下两个生命周期函数 */
      beforeUpdate() {
        /* 此时数据是新的，页面是旧的，即页面尚未和数据保持同步 */
        console.log('beforeUpdate');
      },
      /* 根据新数据生成新的虚拟 DOM，然后进行新旧虚拟 DOM 比较，最终完成页面更新，即 Model (数据) => View (页面) 的更新 */
      updated() {
        /* 此时数据是新的，页面也是新的，即页面和数据保持同步 */
        console.log('updated');
      },
      /* [当 vm.$destroy() 被调用时]，Vue 会在不同的时机调用以下两个生命周期函数 */
      beforeDestroy() {
        /* 此时 vm 中的所有内容 (如 data，methods，指令等) 都处于可用状态，马上执行销毁过程 */
        /* 一般这里进行：关闭定时器、取消订阅消息、解绑自定义事件等收尾工作 */
        console.log('beforeDestroy');
        clearInterval(this.timer)
      },
      /* 消除监视、子组件和自定义事件监听器 */
      destroyed() {
        /* 此时 vm 已经销毁了*/
        console.log('destroy');
      },
    })
  </script>
</body>

</html>