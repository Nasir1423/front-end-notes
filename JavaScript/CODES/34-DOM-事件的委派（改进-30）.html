<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>事件的委派</title>
    <!-- 
        事件委派：是一种优化技术，用于简化代码并提高性能，特别适用于需要监听大量相似事件的情况。基本原理是将事件绑定到父级元素上，
        利用事件冒泡的机制，统一处理子元素的事件。
        - 实现步骤
            - 第一步：将事件绑定到父级元素上，通常是 document 或者父容器元素。
            - 第二步：在事件处理函数中，通过检查事件的目标（event.target）来确定是哪个子元素触发了事件。
        - 优点
            - 简化代码：通过将事件绑定到父级元素上，可以减少事件监听器的数量，从而简化代码结构。
            - 提高性能：减少了事件监听器的数量，可以降低内存消耗并提高页面加载速度，尤其在需要监听大量相似事件的情况下效果更加显著。
        - 说明
            - 检查触发事件的对象：在事件处理函数中，通过检查事件目标，可以确保只有特定的子元素触发了事件时才执行相应的响应函数，避
            免了不必要的函数调用。

        事件的委派：将本应该绑定给多个特定元素的特定事件的回调函数，统一绑定给 document 的特定事件，当特定元素触发事件后，由于事件的冒泡，事件会向上传导到
        document，此时由于 event.target 表示事件触发的对象，通过对 event.target 的检查，可以实现只有特定元素触发事件，响应函数
        才被调用；事件的委派可以降低代码复杂度便于维护
        - 第一步：给 document 绑定事件
        - 第二步：在回调函数中检查触发事件的对象
     -->
    <style>
        /* 表格 */
        #employee-info-list {
            border: 2px black solid;
            border-collapse: collapse;
            width: 400px;
            margin: 0 auto;
        }

        /* 表格-行 */
        #employee-info-list tr {
            text-align: center;
        }

        /* 表格-单元格 */
        #employee-info-list th,
        #employee-info-list td {
            border: 2px black solid;
            padding: 10px;
        }

        /* 表单 */
        #employee-add {
            margin: 20px auto;
            text-align: center;
        }

        /* 表单-提交按钮 */
        #employee-add button {
            margin-top: 10px;
        }
    </style>

    <script>
        /* 
            如何取消超链接的默认行为：跳转？
                - 方式一：当使用 超链接对象.事件属性 = function(){} 给超链接的某个事件绑定响应函数时，使用 return false 结束函数
                - 方式二：超链接的 href 属性取值为 javascript:;
        */
        window.onload = function () {
            // 要求一：删除员工信息

            // 页面中所有超链接
            // 注：类数组对象 links 是实时更新的
            const links = document.links;

            // 事件委派
            document.addEventListener('click', function (event) {
                // 检查触发事件的对象是不是超链接
                const linksArr = [...links];
                if (linksArr.includes(event.target)) {
                    // 待删除的员工信息节点（tr）
                    const employeeInfo = event.target.parentNode.parentNode;
                    // 待删除的员工姓名
                    const employeeName = employeeInfo.firstElementChild.textContent
                    // 确认删除
                    const isDelete = confirm(`确认删除员工: ${employeeName}?`)
                    // 删除员工信息节点
                    if (isDelete) {
                        employeeInfo.remove()
                    }
                }
            })

            // 要求二：添加员工信息

            // 信息提交按钮
            const btnAdd = document.getElementById('btnAdd');
            // 员工信息表格（table-body）
            const employeeInfoList = document.querySelector('#employee-info-list tbody')

            // 事件委派
            document.addEventListener('click', function (event) {
                if (event.target.constructor === HTMLButtonElement) {
                    // 待添加的员工信息节点（tr）
                    const newEmployee = document.createElement('tr')
                    // 用户的输入数据
                    const name = document.getElementById('name').value;
                    const email = document.getElementById('email').value;
                    const salary = document.getElementById('salary').value;
                    // 简单的输入合法性判断
                    if (name && email && salary) {
                        // 将用户的输入数据转变为元素节点（td）
                        const nameTd = document.createElement('td');
                        const emailTd = document.createElement('td');
                        const salaryTd = document.createElement('td');
                        // 给创建的元素节点添加文本值
                        nameTd.innerText = name
                        emailTd.innerText = email
                        salaryTd.innerText = salary
                        // 将创建好且添加好文本值的元素节点添加到待添加的员工信息节点（tr）
                        newEmployee.appendChild(nameTd)
                        newEmployee.appendChild(emailTd)
                        newEmployee.appendChild(salaryTd)
                        // 将删除操作超链接添加到待添加的员工信息节点（tr）
                        newEmployee.insertAdjacentHTML('beforeend', '<td><a href="javascript:;">删除</a></td>')
                        // 将员工信息节点添加进表格
                        employeeInfoList.appendChild(newEmployee)
                        // 清空输入框
                        document.getElementById('name').value = ''
                        document.getElementById('email').value = ''
                        document.getElementById('salary').value = ''
                    } else {
                        alert('请填写完整的员工信息')
                    }
                }
            })
        }
    </script>
</head>

<body>
    <table id="employee-info-list">
        <!-- 表格标题 -->
        <caption>员工信息表</caption>
        <!-- 表格头部 -->
        <thead>
            <tr>
                <th>姓名</th>
                <th>邮件</th>
                <th>薪资</th>
                <th>操作</th>
            </tr>
        </thead>
        <!-- 表格主体 -->
        <tbody>
            <tr>
                <td>孙悟空</td>
                <td>swk@hgs.com</td>
                <td>10000</td>
                <td><a href="javascript:;">删除</a></td>
            </tr>
            <tr>
                <td>猪八戒</td>
                <td>zbj@glz.com</td>
                <td>8000</td>
                <td><a href="javascript:;">删除</a></td>
            </tr>
            <tr>
                <td>沙和尚</td>
                <td>shs@lsh.com</td>
                <td>6000</td>
                <td><a href="javascript:;">删除</a></td>
            </tr>
        </tbody>
        <!-- 表格脚注 -->
        <tfoot></tfoot>
    </table>

    <form action="#" id="employee-add">
        <label>
            姓名 <input type="text" id="name" required>
        </label> <br>
        <label>
            邮件 <input type="email" id="email" required placeholder="xxx@xxx.com">
        </label> <br>
        <label>
            薪资 <input type="number" id="salary" required> <br>
        </label>
        <button type="button" id="btnAdd">添加</button>
    </form>
</body>

</html>